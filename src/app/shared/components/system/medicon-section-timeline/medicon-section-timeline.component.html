<ng-container
    [ngTemplateOutlet]="header"
    [ngTemplateOutletContext]="{isTop: true}">
</ng-container>

<div *ngIf="mediconService.timelineMetrics$ | async; let metrics"
    class="filters" [style.width.px]="metrics.window.width">
    <div class="filter-group">
      <ng-container [ngTemplateOutlet]="filter" [ngTemplateOutletContext]="{label:'Active',checked:true}"></ng-container>
      <ng-container [ngTemplateOutlet]="filter" [ngTemplateOutletContext]="{label:'Inactive',checked:false}"></ng-container>
    </div>
    <div class="filter-group">
      <ng-container [ngTemplateOutlet]="filter" [ngTemplateOutletContext]="{label:'Continuous',checked:true}"></ng-container>
      <ng-container [ngTemplateOutlet]="filter" [ngTemplateOutletContext]="{label:'Periodic',checked:true}"></ng-container>
      <ng-container [ngTemplateOutlet]="filter" [ngTemplateOutletContext]="{label:'SOS',checked:true}"></ng-container>
      <ng-container [ngTemplateOutlet]="filter" [ngTemplateOutletContext]="{label:'Once',checked:true}"></ng-container>
    </div>
</div>

<div class="content">
  <div class="categories" #categories>
    <app-medicon-category
      *ngFor="let category of section.categories; let i=index"
      [category]="category"
      (expandCondense)="onExpandCondense(category.id, $event)">
    </app-medicon-category>
  </div>

  <div class="timelineGraph" #timelineGraph>
    <app-medicon-timeline-graph
      [categories]="section.categories"
      [medications]="medications">
    </app-medicon-timeline-graph>
  </div>
</div>

<ng-container
    [ngTemplateOutlet]="header"
    [ngTemplateOutletContext]="{isTop: false}">
</ng-container>

<ng-template #header let-isTop="isTop">
  <div class="header vertical-center" [class.top]="isTop" [class.bottom]="!isTop">
    <div class="action-icons horizontal-left vertical-center">
      <span class="legend-title"
            [popover]="legendTemplate"
            [placement]="'bottom'"
            [container]="'body'"
            [isOpen]="false"
            [triggers]="'hover'">{{text.medicon.legend}}</span>
      <span><i class="bi bi-plus-circle"></i></span>
      <span><i class="bi bi-alarm"></i></span>
    </div>
    <div><span *ngIf="isTop" class="horizontal-center">{{section.name}}</span></div>
    <div *ngIf="isTop" class="horizontal-right">
      <app-medicon-resolution
          [text]="text"
      ></app-medicon-resolution>
    </div>
  </div>
</ng-template>

<ng-template #legendTemplate>
  <div class="legend" [dir]="direction">
    <ng-container *ngFor="let column of legendColumns; let i=index">
      <ul>
        <li *ngFor="let item of column">
          <div class="vertical-center">
            <app-medicon-icon [type]="item.type" [position]="'aligned'"></app-medicon-icon>
            <span>{{text.medicon.icons[item.type]}}</span>
          </div>
        </li>
      </ul>
    </ng-container>
  </div>
</ng-template>

<ng-template #filter let-label="label" let-checked="checked">
  <div class="filter">
    <input class="form-check-input" [ngClass]="class" type="checkbox" value="something" [attr.checked]="checked ? '' : null">
    <span>{{label}}</span>
  </div>
</ng-template>
